"use strict";(self.webpackChunktame_accommodation=self.webpackChunktame_accommodation||[]).push([[996],{4996:(S,p,r)=>{r.r(p),r.d(p,{SubscriptionsComponent:()=>I});var u=r(4875),_=r(8105),m=r(1384),g=r(6084),b=r(3934),f=r(3750),d=r(6814),h=r(6223),x=r(6313),v=r(4966),Z=r(7945),t=r(9212),y=r(8057),C=r(8950),M=r(7911);const w=["subscribeModal"],O=["paymentModal"],A=["paymentWrapper"],T=["checkinDateElement"];function P(i,c){if(1&i&&(t.TgZ(0,"tr",57)(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.ALo(15,"formatMoney"),t.qZA(),t.TgZ(16,"td"),t._uU(17),t.qZA(),t.TgZ(18,"td"),t._uU(19),t.ALo(20,"formatMoney"),t.qZA(),t.TgZ(21,"td"),t._uU(22),t.ALo(23,"formatMoney"),t.qZA(),t._UZ(24,"td"),t.TgZ(25,"td"),t._uU(26),t.qZA(),t.TgZ(27,"td")(28,"div",58)(29,"button",59),t._UZ(30,"i",60),t.qZA(),t.TgZ(31,"ul",61)(32,"li")(33,"a",62),t._UZ(34,"i",63),t._uU(35," Edit "),t.qZA()(),t.TgZ(36,"li")(37,"a",64),t._UZ(38,"i",65),t._uU(39," Delete "),t.qZA()()()()()()),2&i){const e=c.$implicit,n=t.oxw();t.xp6(2),t.hij("#",e.id,""),t.xp6(2),t.Oqu(null==e.facility?null:e.facility.name),t.xp6(2),t.Oqu(null==e.package?null:e.package.name),t.xp6(2),t.Oqu(null==e||null==e.booking||null==e.booking.client?null:e.booking.client.name),t.xp6(2),t.Oqu(n.formatReservationDate(e.start_date)),t.xp6(2),t.Oqu(n.formatReservationDate(e.end_date)),t.xp6(2),t.Oqu(t.lcZ(15,11,e.price)),t.xp6(3),t.Oqu(e.quantity),t.xp6(2),t.Oqu(t.lcZ(20,13,e.total)),t.xp6(3),t.Oqu(t.lcZ(23,15,0)),t.xp6(4),t.Oqu((null==e||null==e.booking||null==e.booking.creator?null:e.booking.creator.name)||"--")}}function U(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"li",77)(1,"a",78),t.NdJ("click",function(){const a=t.CHM(e).$implicit,s=t.oxw().$implicit,l=t.oxw();return t.KtG(l.addItemToCart(s,a))}),t._uU(2),t._UZ(3,"br"),t.TgZ(4,"span",79),t._uU(5),t.ALo(6,"formatMoney"),t.qZA()()()}if(2&i){const e=c.$implicit;t.xp6(2),t.hij(" ",e.name," "),t.xp6(3),t.AsE("[",t.lcZ(6,3,e.price)," / ",e.period+""+e.unit,"]")}}function k(i,c){if(1&i&&(t.TgZ(0,"div",66)(1,"div",67)(2,"div",68)(3,"span",69),t._uU(4),t.qZA(),t.TgZ(5,"h6",70),t._uU(6),t.qZA(),t.TgZ(7,"span")(8,"em"),t._uU(9),t.qZA()()()(),t.TgZ(10,"div",71)(11,"button",72)(12,"span"),t._uU(13,"Subscribe "),t._UZ(14,"i",73),t.qZA()(),t.TgZ(15,"ul",74)(16,"li")(17,"h6",75),t._uU(18,"Select Package"),t.qZA()(),t.YNc(19,U,7,5,"li",76),t.qZA()()()),2&i){const e=c.$implicit;t.xp6(4),t.Oqu(e.category),t.xp6(2),t.Oqu(e.name),t.xp6(3),t.hij("(",null==e.packages?null:e.packages.length," Packages)"),t.xp6(10),t.Q6J("ngForOf",e.packages)}}function E(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"div",80)(1,"a",81),t.NdJ("click",function(){const a=t.CHM(e).index,s=t.oxw();return t.KtG(s.cart.splice(a,1))}),t._UZ(2,"em",82),t.qZA(),t.TgZ(3,"div",83)(4,"div",84)(5,"p",85),t._uU(6),t.TgZ(7,"span",86),t._uU(8),t.qZA()(),t.TgZ(9,"span",87),t._uU(10),t.qZA()(),t.TgZ(11,"div",88)(12,"span",89),t._uU(13),t.qZA()()(),t.TgZ(14,"div",90)(15,"div",91)(16,"div",92)(17,"span",93)(18,"button",94),t.NdJ("click",function(){const a=t.CHM(e).index,s=t.oxw();return t.KtG(s.decreaseQuantity(a))}),t._uU(19," - "),t.qZA()(),t._UZ(20,"input",95),t.TgZ(21,"span",96)(22,"button",97),t.NdJ("click",function(){const a=t.CHM(e).index,s=t.oxw();return t.KtG(s.increaseQuantity(a))}),t._uU(23," + "),t.qZA()()()(),t.TgZ(24,"div",98),t._uU(25),t.ALo(26,"formatMoney"),t.qZA(),t.TgZ(27,"div",99),t._uU(28),t.ALo(29,"formatMoney"),t.qZA()()()}if(2&i){const e=c.$implicit;t.xp6(6),t.hij(" ",e.package_name,""),t.xp6(2),t.hij("[",e.package_unit,"]"),t.xp6(2),t.Oqu(e.facility_name),t.xp6(3),t.Oqu(e.category),t.xp6(7),t.Q6J("value",e.quantity),t.xp6(5),t.Oqu(t.lcZ(26,7,e.price)),t.xp6(3),t.hij(" ",t.lcZ(29,9,e.amount)," ")}}function D(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"div",100)(1,"div",101)(2,"span",102),t._uU(3),t.ALo(4,"formatMoney"),t.qZA(),t.TgZ(5,"button",103),t.NdJ("click",function(){t.CHM(e),t.oxw();const o=t.MAs(59);return t.KtG(o.show())}),t.TgZ(6,"span"),t._uU(7,"Proceed "),t._UZ(8,"em",104),t.qZA()()()()}if(2&i){const e=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,2,e.totalAmount)),t.xp6(2),t.Q6J("disabled",!e.checkinDate||!e.clientId)}}function q(i,c){if(1&i&&t._UZ(0,"payment-wrapper",105,106),2&i){const e=t.oxw();t.Q6J("total",e.totalAmount)("paidAmount",0)}}let I=(()=>{class i{constructor(e,n,o){this.fs=e,this.ps=n,this.ts=o,this.rows=[],this.columns=[{title:"S/N"},{title:"Facility",sortable:!0},{title:"Package",sortable:!0},{title:"Guest",sortable:!0},{title:"Check-in"},{title:"Check-out"},{title:"Price",sortable:!0},{title:"Qty",sortable:!0},{title:"Amount",sortable:!0},{title:"Balance",sortable:!0},{title:"Status",sortable:!0},{title:"Created By",sortable:!0}],this.clientId=0,this.cart=[],this.facilities=[],this.checkinDate=""}ngOnInit(){this.ps.rows$.subscribe(e=>{this.rows=e}),this.fs.getCategories().subscribe(e=>{this.facilities=e})}ngAfterViewInit(){(0,u.Z)(this.checkinDateElement.nativeElement,{enableTime:!0,dateFormat:"Y-m-d",minDate:"today",defaultDate:"today",onChange:(n,o,a)=>{this.checkinDate=o},onReady:(n,o,a)=>{this.checkinDate=o}})}get cartPackages(){return this.cart.map(e=>e.package_id)}get totalAmount(){return this.cart.reduce((e,n)=>e+Number(n.amount),0)}addItemToCart(e,n){this.cartPackages.includes(Number(n.id))?this.ts.setMessage({type:"warning",text:"Package already added"}):(this.cart.push({facility_id:e.id,category:e?.category?.name,package_id:n.id,facility_name:e.name,package_name:n.name,price:Number(n.price),quantity:1,amount:Number(n.price),package_unit:`${n.period} ${n.unit}`}),this.ts.setMessage({type:"success",text:"Package added successfully"}))}increaseQuantity(e){this.cart[e].quantity+=1,this.calculateTotal(e)}decreaseQuantity(e){this.cart[e].quantity-=1,this.cart[e].quantity<=0&&this.cart.splice(e,1),this.calculateTotal(e)}calculateTotal(e){this.cart[e].amount=Number(this.cart[e].quantity)*Number(this.cart[e].price)}formatReservationDate(e){return x.b.formatDate(e,!0)}handleSubmit(){const e=this.paymentWrapper.getPaymentData();this.fs.handleSubscribeAction(Z._.generateFormData({client_id:this.clientId,facilities:this.cart,checkin_date:this.checkinDate,total:this.totalAmount,...e})).subscribe(o=>{this.ts.setMessage({type:"success",text:"Reservation made successfully"}),this.rows=[...this.rows,...o],this.paymentModal.hide(),this.paymentWrapper.paymentForm.reset(),this.subscribeModal.hide(),this.cart=[]})}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(y.j),t.Y36(C.N),t.Y36(M.k))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["subscriptions"]],viewQuery:function(n,o){if(1&n&&(t.Gf(w,5),t.Gf(O,5),t.Gf(A,5),t.Gf(T,5)),2&n){let a;t.iGM(a=t.CRH())&&(o.subscribeModal=a.first),t.iGM(a=t.CRH())&&(o.paymentModal=a.first),t.iGM(a=t.CRH())&&(o.paymentWrapper=a.first),t.iGM(a=t.CRH())&&(o.checkinDateElement=a.first)}},standalone:!0,features:[t.jDz],decls:68,vars:13,consts:[[1,"row"],[1,"col-12"],[1,"page-title-box","d-sm-flex","align-items-center","justify-content-between"],[1,"mb-sm-0"],[1,"page-title-right"],[1,"breadcrumb","m-0"],[1,"breadcrumb-item"],["href","javascript: void(0);"],[1,"breadcrumb-item","active"],["url","facilities/subscriptions",3,"columns"],["href","javascript:void(0)","prevent","","action","",1,"btn","btn-primary",3,"click"],[1,"ri-add-line","me-1","fs-16","align-middle"],["filters","",1,"d-flex","py-3","align-items-center","gap-3"],["rows","",4,"ngFor","ngForOf"],["classes","zoomIn","dialogClasses","modal-lg modal-dialog-centered modal-dialog-scrollables p-0",3,"customId","showFooter"],["subscribeModal",""],["title",""],["body","",2,"max-height","400px","position","relative","overflow-y","hidden","overflow-x","hidden"],[1,"row","gx-0"],[1,"col-lg-7","border-end","bg-white","shadow"],[1,"d-flex","subscribe-column","flex-column","align-items-center"],[1,"p-2","pt-0","w-100","position-sticky","top-0","border-bottom","shadow",2,"background","#fff"],[1,"auth-input"],[1,"d-flex","align-items-center"],[1,"me-1"],["for","checkin-date",1,"form-label"],["type","datetime-local","id","datetimePicker","placeholder","Select Date",1,"form-control","input-sm"],["checkinDateElement",""],[1,"container-fluid",2,"flex","1"],[1,"row","row-cols-2","row-cols-lg-3"],["class","col border",4,"ngFor","ngForOf"],[1,"col-lg-5","bg-white"],[1,"d-flex","subscribe-column","flex-column","align-items-center",2,"max-height","350px","height","350px","overflow-y","auto","overflow-x","hidden"],[1,"p-2","pt-0","w-100","position-sticky","top-0","border-bottom","shadow",2,"background","#fff","z-index","10"],[1,"d-flex","w-100"],[2,"flex","1"],[1,"auth-input","sm"],["for","title",1,"form-label","required",2,"z-index","10"],["url","clients/search?with_phones=1","label","name","placeholder","Select Customer","fetchFlag","SEARCHING_CLIENTS",3,"loadDefaults","selection","selectionChange"],["footer","",1,"position-sticky","bottom-0","bg-white"],[1,"border-top","dropdown-item","pl-7"],["href","javascript:void(0)"],[1,"text-blue","cursor-pointer"],["height","18px","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","12","r","10"],["x1","12","y1","8","x2","12","y2","16"],["x1","8","y1","12","x2","16","y2","12"],[1,"p-2","w-100","bg-light",2,"flex","1"],["class","border rounded mb-2 p-2 bg-white position-relative",4,"ngFor","ngForOf"],["class","pay-now position-sticky bottom-0 bg-white border-top shadow w-100 p-2","style","z-index: 11",4,"ngIf"],["classes","modal-sm fade fadeInRight","dialogClasses","modal-dialog-bottom-right",3,"customId","noBackDrop"],["paymentModal",""],["body",""],[3,"total","paidAmount",4,"ngIf"],["footer","",1,"d-grid","w-100"],["classes","btn btn-primary w-100","type","button",3,"task","clicked"],["caption",""],["rows",""],[1,""],["type","button","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","btn-soft-primary","btn-sm","dropdown"],[1,"ri-more-fill","align-middle","fs-18"],[1,"dropdown-menu","dropdown-menu-end"],["href","javascript:void(0);","prevent","",1,"dropdown-item"],[1,"ri-pencil-fill","fs-18","align-middle","me-2","text-muted"],["href","javascript:void(0)","prevent","",1,"dropdown-item","remove-item-btn"],[1,"ri-delete-bin-line","fs-18","align-middle","me-2","text-muted"],[1,"col","border"],[1,"pb-5","px-1","mb-2","h-100","d-flex","align-items-center","justify-content-center"],[1,"details","text-center"],[1,"badge","rounded-pill","badge-soft-info"],[1,"mb-0","mt-1"],[1,"position-absolute","bottom-0","mb-1",2,"left","39%","transform","translateX(-33%)","z-index","1"],["role","button","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","btn-sm","btn-primary"],[1,"ri-arrow-down-s-fill","align-middle"],["data-popper-placement","bottom-start",1,"dropdown-menu","dropdown-menu-start"],[1,"dropdown-header","mb-0"],["class","border-bottom",4,"ngFor","ngForOf"],[1,"border-bottom"],["href","javascript:void(0);","prevent","",1,"dropdown-item",3,"click"],[1,"fs-14"],[1,"border","rounded","mb-2","p-2","bg-white","position-relative"],["href","javascript:void(0)",1,"text-danger","position-absolute","end-0","top-0","me-1",3,"click"],[1,"ri-close-circle-line","fs-18"],[1,"d-flex","align-items-center","flex-nowrap","mt-2"],[1,"d-block","flex-grow-1"],[1,"mb-0","fs-15","text-dark"],[1,"fs-12","text-success"],[1,"m-0","text-muted","fs-12"],[1,"ms-auto"],[1,"badge","rounded-pill","badge-soft-info","fs-12"],[1,"mt-3","d-flex","align-items-center","justify-content-between"],[1,"dz-stepper","small-stepper","border","rounded"],[1,"input-group","bootstrap-touchspin","bootstrap-touchspin-injected"],[1,"input-group-btn","input-group-prepend"],["type","button",1,"btn","btn-info","bootstrap-touchspin-down",3,"click"],["type","text",1,"stepper","form-control",3,"value"],[1,"input-group-btn","input-group-append"],["type","button",1,"btn","btn-primary","bootstrap-touchspin-up",3,"click"],[1,"amount","fw-13"],[1,"total","fw-bold","fw-13"],[1,"pay-now","position-sticky","bottom-0","bg-white","border-top","shadow","w-100","p-2",2,"z-index","11"],[1,"d-flex","align-items-center","justify-content-between"],[1,"fw-bold","fs-13"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"ri-arrow-right-line",2,"vertical-align","middle"],[3,"total","paidAmount"],["paymentWrapper",""]],template:function(n,o){if(1&n){const a=t.EpF();t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),t._uU(4,"Subscriptions"),t.qZA(),t.TgZ(5,"div",4)(6,"ol",5)(7,"li",6)(8,"a",7),t._uU(9,"Facilities"),t.qZA()(),t.TgZ(10,"li",8),t._uU(11,"subscriptions"),t.qZA()()()()()(),t.TgZ(12,"app-pagination",9)(13,"a",10),t.NdJ("click",function(){t.CHM(a);const l=t.MAs(19);return t.KtG(l.show())}),t._UZ(14,"i",11),t._uU(15," New Subscription "),t.qZA(),t._UZ(16,"div",12),t.YNc(17,P,40,17,"tr",13),t.qZA(),t.TgZ(18,"app-modal",14,15)(20,"span",16),t._uU(21,"Add Subscriptions"),t.qZA(),t.TgZ(22,"div",17)(23,"div",18)(24,"div",19)(25,"div",20)(26,"div",21)(27,"div",22)(28,"div",23)(29,"div",24)(30,"label",25),t._uU(31,"Check-in Dates"),t.qZA(),t._UZ(32,"input",26,27),t.qZA()()()(),t.TgZ(34,"div",28)(35,"div",29),t.YNc(36,k,20,4,"div",30),t.qZA()()()(),t.TgZ(37,"div",31)(38,"div",32)(39,"div",33)(40,"div",34)(41,"div",35)(42,"div",36)(43,"label",37),t._uU(44,"Customer"),t.qZA(),t.TgZ(45,"app-custom-select",38),t.NdJ("selectionChange",function(l){return o.clientId=l}),t.TgZ(46,"div",39)(47,"li",40)(48,"a",41)(49,"span",42),t.O4$(),t.TgZ(50,"svg",43),t._UZ(51,"circle",44)(52,"line",45)(53,"line",46),t.qZA(),t._uU(54," \xa0Add New"),t.qZA()()()()()()()()(),t.kcU(),t.TgZ(55,"div",47),t.YNc(56,E,30,11,"div",48),t.qZA(),t.YNc(57,D,9,4,"div",49),t.qZA()()()()(),t.TgZ(58,"app-modal",50,51)(60,"span",16),t._uU(61,"Process Payment"),t.qZA(),t.TgZ(62,"div",52),t.YNc(63,q,2,2,"payment-wrapper",53),t.qZA(),t.TgZ(64,"div",54)(65,"app-button",55),t.NdJ("clicked",function(){return o.handleSubmit()}),t.TgZ(66,"span",56),t._uU(67,"Confirm and Save"),t.qZA()()()()}2&n&&(t.xp6(12),t.Q6J("columns",o.columns),t.xp6(5),t.Q6J("ngForOf",o.rows),t.xp6(1),t.Q6J("customId","subscribeModal")("showFooter",!1),t.xp6(18),t.Q6J("ngForOf",o.facilities),t.xp6(9),t.Q6J("loadDefaults",!0)("selection",o.clientId),t.xp6(11),t.Q6J("ngForOf",o.cart),t.xp6(1),t.Q6J("ngIf",o.cart.length),t.xp6(1),t.Q6J("customId","payment-modal")("noBackDrop",!0),t.xp6(5),t.Q6J("ngIf",o.totalAmount),t.xp6(2),t.Q6J("task","BOOKING_FACILITIES"))},dependencies:[_.z,g.Q,d.ax,d.O5,m.r,h.UX,b.y,f.T,v.l],styles:[".payment-hidden[_ngcontent-%COMP%]{visibility:hidden;padding:0!important;transform:translateY(100%)}.payment-wrapper[_ngcontent-%COMP%]{transition:visibility .5s,padding .5s ease,transform .5s ease;transition-timing-function:cubic-bezier(.005,1.045,.25,.915)!important}.dz-stepper[_ngcontent-%COMP%]{width:70px;padding:.1rem!important}.dz-stepper[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{text-align:center;display:block;color:var(--dark);font-weight:500;margin-bottom:5px}.dz-stepper[_ngcontent-%COMP%]   .bootstrap-touchspin[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:0}.dz-stepper[_ngcontent-%COMP%]   .bootstrap-touchspin[_ngcontent-%COMP%]   .input-group-btn[_ngcontent-%COMP%]{height:100%}.dz-stepper[_ngcontent-%COMP%]   .bootstrap-touchspin[_ngcontent-%COMP%]   .input-group-btn[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:0;text-align:center;border:1px solid var(--border-color);font-size:18px;line-height:1}.dz-stepper[_ngcontent-%COMP%]   .bootstrap-touchspin[_ngcontent-%COMP%]   .input-group-btn[_ngcontent-%COMP%]:not(:first-child){padding:0}.dz-stepper[_ngcontent-%COMP%]   .bootstrap-touchspin[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{padding:0 5px;height:100%;font-weight:500;color:var(--dark);background:0 0;border:0;z-index:3;text-align:center}.dz-stepper.border-2[_ngcontent-%COMP%]   .bootstrap-touchspin[_ngcontent-%COMP%]{overflow:hidden}.dz-stepper.border-2[_ngcontent-%COMP%]   .bootstrap-touchspin[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-width:2px}.dz-stepper.small-stepper[_ngcontent-%COMP%]   .bootstrap-touchspin[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:22px;height:22px}.input-group[_ngcontent-%COMP%] > .form-control[_ngcontent-%COMP%]:focus{z-index:unset}.overflow-x-0[_ngcontent-%COMP%]{overflow-x:hidden!important}"]})}return i})()}}]);