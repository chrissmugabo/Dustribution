"use strict";(self.webpackChunktame_accommodation=self.webpackChunktame_accommodation||[]).push([[786],{7786:(f,u,r)=>{r.r(u),r.d(u,{FacilitiesComponent:()=>P});var _=r(6814),m=r(1384),l=r(6166),b=r(6084),i=r(6223),p=r(3780),g=r(7945),h=r(4966),t=r(9212),v=r(8950),Z=r(8057),C=r(7911),M=r(7612);const y=["facilityModal"];function A(s,d){if(1&s){const e=t.EpF();t.TgZ(0,"tr",45)(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.ALo(11,"formatMoney"),t.qZA(),t.TgZ(12,"td"),t._uU(13),t.qZA(),t.TgZ(14,"td")(15,"div",46)(16,"button",47),t._UZ(17,"i",48),t.qZA(),t.TgZ(18,"ul",49)(19,"li")(20,"a",50),t.NdJ("click",function(){const a=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.showFacilityModal(a))}),t._UZ(21,"i",51),t._uU(22," Edit "),t.qZA()(),t.TgZ(23,"li")(24,"a",52),t.NdJ("click",function(){const a=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.handleDestroy(a))}),t._UZ(25,"i",53),t._uU(26," Delete "),t.qZA()()()()()()}if(2&s){const e=d.$implicit;t.xp6(2),t.hij("#",e.id,""),t.xp6(2),t.Oqu(null==e?null:e.name),t.xp6(2),t.Oqu(null==e||null==e.category?null:e.category.name),t.xp6(2),t.Oqu(null==e||null==e.branch?null:e.branch.name),t.xp6(2),t.Oqu(t.lcZ(11,6,null==e?null:e.price)),t.xp6(3),t.Oqu(null==e?null:e.description)}}function T(s,d){if(1&s&&(t.TgZ(0,"option",54),t._uU(1),t.qZA()),2&s){const e=d.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function x(s,d){if(1&s){const e=t.EpF();t.TgZ(0,"button",55),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.addPackage())}),t._uU(1," Add Package "),t.qZA()}}function F(s,d){if(1&s){const e=t.EpF();t.TgZ(0,"div",56)(1,"div",57)(2,"button",58),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.addPackage())}),t._UZ(3,"span",59),t.qZA(),t.TgZ(4,"button",58),t.NdJ("click",function(){const a=t.CHM(e).index,c=t.oxw();return t.KtG(c.removePackage(a))}),t._UZ(5,"span",60),t.qZA()(),t.TgZ(6,"div",61)(7,"div",62)(8,"div",1)(9,"label",63),t._uU(10,"Package Name"),t.qZA(),t._UZ(11,"input",64),t.qZA(),t.TgZ(12,"div",65)(13,"label",66),t._uU(14,"Price"),t.qZA(),t._UZ(15,"input",67),t.qZA(),t.TgZ(16,"div",65)(17,"label",68),t._uU(18,"Period"),t.qZA(),t._UZ(19,"input",69),t.qZA(),t.TgZ(20,"div",65)(21,"label",66),t._uU(22,"Unit"),t.qZA(),t.TgZ(23,"select",70)(24,"option",71),t._uU(25,"Days"),t.qZA(),t.TgZ(26,"option",72),t._uU(27,"Weeks"),t.qZA(),t.TgZ(28,"option",73),t._uU(29,"Months"),t.qZA(),t.TgZ(30,"option",74),t._uU(31,"Years"),t.qZA()()()()()()}if(2&s){const e=d.index;t.xp6(6),t.Q6J("formGroupName",e)}}let P=(()=>{class s{constructor(e,n,o,a,c){this.paginationService=e,this.fs=n,this.toastService=o,this.uiService=a,this.fb=c,this.categories=[],this.rows=[],this.columns=[{title:"S/N"},{title:"Title",sortable:!0},{title:"Category",sortable:!0},{title:"Branch",sortable:!0},{title:"Fixed Price",sortable:!0},{title:"description",sortable:!0}],this.facilityForm=this.fb.group({id:[null],branch_id:[null],name:["",i.kI.required],category_id:[null,i.kI.required],description:[""],price:[0],status:[1],packages:this.fb.array([])})}get packages(){return this.facilityForm?.get("packages")}addPackage(){const e=this.fb.group({id:[null],name:["",i.kI.required],price:[0,i.kI.min(0)],unit:["days"],period:[1]});this.packages.push(e)}removePackage(e){this.packages.removeAt(e)}ngOnInit(){this.paginationService.rows$.subscribe(e=>{this.rows=e}),this.fs.getGroups().subscribe(e=>{this.categories=e})}createPackageFormGroup(e){return this.fb.group({id:[e.id],name:[e.name,i.kI.required],price:[e.price,i.kI.min(0)],unit:[e.unit||"days"],period:[e.period||1]})}showFacilityModal(e){if(e){this.facilityForm.patchValue(e);const n=e?.packages;n?.length&&n.forEach(o=>{this.packages.push(this.createPackageFormGroup(o))})}this.facilityModal.show()}handleSubmit(){const e=this.facilityForm.value,n=e.packages?.filter(o=>o.id).map(o=>o.id);this.fs.save(g._.generateFormData({...e,existing_packages:n})).subscribe(o=>{if(e.id){const a=this.rows.findIndex(c=>c.id===e.id);-1!==a&&(this.rows[a]=o)}else this.rows.unshift(o);this.toastService.setMessage({type:"success",text:"Record saved successfully"}),this.facilityForm.reset();for(let a=0;a<this.packages.length;a++)this.packages.removeAt(a);this.facilityModal.hide()})}handleDestroy(e){this.uiService.confirm({title:"Deleting a facility",content:"Are you sure you want to this facility:"+e.name,action:()=>{this.fs.delete(e.id).subscribe(()=>{const n=this.rows.findIndex(o=>o.id==e.id);-1!==n&&(this.rows.splice(n,1),this.toastService.setMessage({type:"success",text:"Record deleted successfully"}))})}})}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(v.N),t.Y36(Z.j),t.Y36(C.k),t.Y36(M.F),t.Y36(i.qu))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-facilities"]],viewQuery:function(n,o){if(1&n&&t.Gf(y,5),2&n){let a;t.iGM(a=t.CRH())&&(o.facilityModal=a.first)}},standalone:!0,features:[t.jDz],decls:68,vars:10,consts:[[1,"row"],[1,"col-12"],[1,"page-title-box","d-sm-flex","align-items-center","justify-content-between"],[1,"mb-sm-0"],[1,"page-title-right"],[1,"breadcrumb","m-0"],[1,"breadcrumb-item"],["href","javascript: void(0);"],[1,"breadcrumb-item","active"],["url","facilities",3,"columns"],["href","javascript:void(0)","prevent","","action","",1,"btn","btn-primary",3,"click"],[1,"ri-add-line","me-1","fs-16","align-middle"],["filters","",1,"d-flex","py-3","align-items-center","gap-3"],["rows","",4,"ngFor","ngForOf"],[3,"customId"],["facilityModal",""],["title",""],["body",""],[1,"auth-input",3,"formGroup","ngSubmit"],[1,"row","gy-1","gx-1"],[1,"fw-semibold","fs-15","mb-1"],[1,"mb-0"],["for","title",1,"form-label","required"],["type","text","id","name","formControlName","name",1,"form-control"],[1,"col-lg-12"],["for","branch",1,"form-label","required"],["url","branches/show","label","name","placeholder","Select Branch","fetchFlag","SEARCHING_BRANCHS",3,"loadDefaults","selection","selectionChange"],[1,"col-6"],["for","type",1,"form-label","required"],["id","type","formControlName","category_id",1,"form-select","form-control-lg"],["value","null","hidden","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["for","price",1,"form-label","required"],["type","number","id","price","placeholder","Price","formControlName","price",1,"form-control"],["for","description",1,"form-label"],["id","description","formControlName","description","placeholder","Optional Comments",1,"form-control"],[1,"d-flex","align-items-center","justify-content-between","pb-2","pt-3","mb-1","border-bottom"],[1,"fw-semibold","fs-15","mb-0"],["class","btn btn-primary btn-sm","type","button",3,"click",4,"ngIf"],["formArrayName","packages"],["class","p-2 position-relative rounded border mb-3",4,"ngFor","ngForOf"],["footer","",1,"row"],["type","button",1,"btn","btn-light","w-100",3,"click"],["task","ADDING_FACILITY","classes","btn btn-primary w-100","type","button",1,"w-100",3,"disabled","clicked"],["caption",""],["rows",""],[1,""],["type","button","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","btn-soft-primary","btn-sm","dropdown"],[1,"ri-more-fill","align-middle","fs-18"],[1,"dropdown-menu","dropdown-menu-end"],["href","javascript:void(0);","prevent","",1,"dropdown-item",3,"click"],[1,"ri-pencil-fill","fs-18","align-middle","me-2","text-muted"],["href","javascript:void(0)","prevent","",1,"dropdown-item","remove-item-btn",3,"click"],[1,"ri-delete-bin-line","fs-18","align-middle","me-2","text-muted"],[3,"value"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],[1,"p-2","position-relative","rounded","border","mb-3"],[1,"position-absolute","position-absolute","end-0","top-0","me-2",2,"z-index","10"],["type","button",1,"btnChoiceOpt",3,"click"],[1,"iconAddChoice",2,"background","url(./assets/img/addMore.svg) center no-repeat"],[1,"iconRemoveChoice",2,"background","url(./assets/img/remove_black.svg) center\n                      no-repeat rgba(0, 0, 0, 0)"],[3,"formGroupName"],[1,"row","gy-1","gx-1","mb-2"],["for","Package",1,"form-label","required"],["type","text","formControlName","name",1,"form-control","input-sm"],[1,"col-4"],["for","PackagePirce",1,"form-label","required"],["type","number","formControlName","price",1,"form-control","input-sm"],["for","PackagePeriod",1,"form-label","required"],["type","number","formControlName","period",1,"form-control","input-sm"],["formControlName","unit",1,"form-select","input-sm"],["value","days"],["value","weeks"],["value","months"],["value","years"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),t._uU(4,"Facilities List"),t.qZA(),t.TgZ(5,"div",4)(6,"ol",5)(7,"li",6)(8,"a",7),t._uU(9,"Facilities"),t.qZA()(),t.TgZ(10,"li",8),t._uU(11,"List"),t.qZA()()()()()(),t.TgZ(12,"app-pagination",9)(13,"a",10),t.NdJ("click",function(){return o.showFacilityModal()}),t._UZ(14,"i",11),t._uU(15," Add New "),t.qZA(),t._UZ(16,"div",12),t.YNc(17,A,27,8,"tr",13),t.qZA(),t.TgZ(18,"app-off-canvas",14,15)(20,"span",16),t._uU(21,"Add A Facilty"),t.qZA(),t.TgZ(22,"div",17)(23,"form",18),t.NdJ("ngSubmit",function(){return o.handleSubmit()}),t.TgZ(24,"div",19)(25,"h6",20),t._uU(26,"Basic Details"),t.qZA(),t.TgZ(27,"div",1)(28,"div",21)(29,"label",22),t._uU(30,"Name"),t.qZA(),t._UZ(31,"input",23),t.qZA()(),t.TgZ(32,"div",24)(33,"label",25),t._uU(34,"Branch"),t.qZA(),t.TgZ(35,"app-bootstrap-select",26),t.NdJ("selectionChange",function(c){return o.facilityForm.value.branch_id=c}),t.qZA()(),t.TgZ(36,"div",27)(37,"div",21)(38,"label",28),t._uU(39,"Category"),t.qZA(),t.TgZ(40,"select",29)(41,"option",30),t._uU(42,"Select Category"),t.qZA(),t.YNc(43,T,2,2,"option",31),t.qZA()()(),t.TgZ(44,"div",27)(45,"div",21)(46,"label",32),t._uU(47,"Price"),t.qZA(),t._UZ(48,"input",33),t.qZA()(),t.TgZ(49,"div",1)(50,"div",21)(51,"label",34),t._uU(52,"Description"),t.qZA(),t._UZ(53,"textarea",35),t.qZA()(),t.TgZ(54,"div",36)(55,"h6",37),t._uU(56,"Packages"),t.qZA(),t.YNc(57,x,2,0,"button",38),t.qZA(),t.TgZ(58,"div",39),t.YNc(59,F,32,1,"div",40),t.qZA()()()(),t.TgZ(60,"div",41)(61,"div",27)(62,"button",42),t.NdJ("click",function(){return o.facilityForm.reset()}),t._uU(63," Reset "),t.qZA()(),t.TgZ(64,"div",27)(65,"app-button",43),t.NdJ("clicked",function(){return o.handleSubmit()}),t.TgZ(66,"span",44),t._uU(67,"Save"),t.qZA()()()()()),2&n&&(t.xp6(12),t.Q6J("columns",o.columns),t.xp6(5),t.Q6J("ngForOf",o.rows),t.xp6(1),t.Q6J("customId","facilityModal"),t.xp6(5),t.Q6J("formGroup",o.facilityForm),t.xp6(12),t.Q6J("loadDefaults",!0)("selection",o.facilityForm.value.branch_id),t.xp6(8),t.Q6J("ngForOf",o.categories),t.xp6(14),t.Q6J("ngIf",!o.packages.length),t.xp6(2),t.Q6J("ngForOf",o.packages.controls),t.xp6(6),t.Q6J("disabled",!o.facilityForm.valid))},dependencies:[b.Q,_.ax,_.O5,m.r,l.i,i.UX,i._Y,i.YN,i.Kr,i.Fj,i.wV,i.EJ,i.JJ,i.JL,i.sg,i.u,i.x0,i.CE,p.v,h.l],styles:[".btnChoiceOpt[_ngcontent-%COMP%]{padding:0}.btnChoiceOpt[_ngcontent-%COMP%]:active{outline:0}.btnChoiceOpt[_ngcontent-%COMP%]{border:none!important}[_ngcontent-%COMP%]:active, [_ngcontent-%COMP%]:focus{outline:0!important;text-decoration:none}.btnChoiceOpt[_ngcontent-%COMP%]{margin:8px 0 8px 10px;width:18px;height:18px;background:0;vertical-align:middle;cursor:pointer}.btnChoiceOpt[_ngcontent-%COMP%]:first-child{margin-left:0}.iconAddChoice[_ngcontent-%COMP%], .iconRemoveChoice[_ngcontent-%COMP%]{display:inline-block;background-size:cover}.iconAddChoice[_ngcontent-%COMP%]{width:13px;height:13px}.iconRemoveChoice[_ngcontent-%COMP%]{width:11px;height:11px}.doubled-caret[_ngcontent-%COMP%]:after{bottom:2.67px;border-top:4px #666 solid}"]})}return s})()},4966:(f,u,r)=>{r.d(u,{l:()=>m});var _=r(9212);let m=(()=>{class l{transform(i,...p){return p[0]?"RWF "+this.formatNumber(i):(i.toString().indexOf(".")>-1&&(i=Number(i).toFixed(0)),"RWF "+i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))}formatNumber(i){return 999<Math.abs(i)&&Math.abs(i)<999999?Math.sign(i)*Number((Math.abs(i)/1e3).toFixed(1))+"K":999999<Math.abs(i)&&Math.abs(i)<999999999?Math.sign(i)*Number((Math.abs(i)/1e6).toFixed(1))+"M":999999999<Math.abs(i)&&Math.abs(i)<999999999999?Math.sign(i)*Number((Math.abs(i)/1e9).toFixed(1))+"B":999999999999<Math.abs(i)?Math.sign(i)*Number((Math.abs(i)/1e12).toFixed(1))+"T":""+Math.sign(i)*Math.abs(i)}static#t=this.\u0275fac=function(p){return new(p||l)};static#e=this.\u0275pipe=_.Yjl({name:"formatMoney",type:l,pure:!0,standalone:!0})}return l})()}}]);