"use strict";(self.webpackChunktame_accommodation=self.webpackChunktame_accommodation||[]).push([[974],{974:(q,m,a)=>{a.r(m),a.d(m,{ReservationsComponent:()=>x});var _=a(6814),u=a(4875),h=a(1384),g=a(6166),v=a(6084),f=a(3934),b=a(3750),Z=a(7945),l=a(6223),T=a(4966),e=a(9212),A=a(8950),y=a(8185),C=a(7911),D=a(7612);const U=["reservationModal"],O=["startDate"],E=["endDate"],I=["paymentWrapper"];function w(r,d){if(1&r&&(e.TgZ(0,"tr",48)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.ALo(13,"formatMoney"),e.qZA(),e.TgZ(14,"td"),e._uU(15),e.ALo(16,"formatMoney"),e.qZA(),e._UZ(17,"td"),e.TgZ(18,"td"),e._uU(19),e.qZA(),e.TgZ(20,"td")(21,"div",49)(22,"button",50),e._UZ(23,"i",51),e.qZA(),e.TgZ(24,"ul",52)(25,"li")(26,"a",53),e._UZ(27,"i",54),e._uU(28," Edit "),e.qZA()(),e.TgZ(29,"li")(30,"a",55),e._UZ(31,"i",56),e._uU(32," Delete "),e.qZA()()()()()()),2&r){const t=d.$implicit,n=e.oxw();e.xp6(2),e.hij("#",t.id,""),e.xp6(2),e.Oqu(t.details.name),e.xp6(2),e.Oqu(null==t.booking||null==t.booking.client?null:t.booking.client.name),e.xp6(2),e.Oqu(n.formatReservationTime(t.start_date)),e.xp6(2),e.Oqu(n.formatReservationTime(t.end_date)),e.xp6(2),e.Oqu(e.lcZ(13,8,t.price)),e.xp6(3),e.Oqu(e.lcZ(16,10,0)),e.xp6(4),e.Oqu((null==t.booking||null==t.booking.creator?null:t.booking.creator.name)||"--")}}function M(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div",20)(1,"app-button",57),e.NdJ("clicked",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.checkAvailability())}),e.TgZ(2,"span",41),e._uU(3,"Check Availability"),e.qZA()()()}if(2&r){const t=e.oxw();e.xp6(1),e.Q6J("disabled",t.checkAvailabilityForbidden)}}function R(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div",23)(1,"div",24)(2,"label",58),e._uU(3,"Customer"),e.qZA(),e.TgZ(4,"app-custom-select",59),e.NdJ("selectionChange",function(i){e.CHM(t);const o=e.oxw();return e.KtG(o.clientId=i)}),e.TgZ(5,"div",60)(6,"li",61)(7,"a",62)(8,"span",63),e.O4$(),e.TgZ(9,"svg",64),e._UZ(10,"circle",65)(11,"line",66)(12,"line",67),e.qZA(),e._uU(13," \xa0Add New"),e.qZA()()()()()()(),e.kcU(),e.TgZ(14,"div",23)(15,"div",24)(16,"label",68),e._uU(17,"Price"),e.qZA(),e._UZ(18,"input",69),e.qZA()(),e.TgZ(19,"div",1)(20,"div",24)(21,"label",70),e._uU(22,"Comment"),e.qZA(),e._UZ(23,"textarea",71),e.qZA()()}if(2&r){const t=e.oxw();e.xp6(4),e.Q6J("loadDefaults",!0)("selection",t.clientId)}}function k(r,d){if(1&r&&e._UZ(0,"payment-wrapper",72,73),2&r){const t=e.oxw();e.Q6J("total",t.reservationForm.value.price)("paidAmount",0)("horizontal",!0)}}let x=(()=>{class r{constructor(t,n,i,o,s){this.paginationService=t,this.hallService=n,this.toastService=i,this.uiService=o,this.fb=s,this.rows=[],this.columns=[{title:"S/N"},{title:"Hall",sortable:!0},{title:"Guest",sortable:!0},{title:"Check-in"},{title:"Check-out"},{title:"Amount",sortable:!0},{title:"Balance",sortable:!0},{title:"Status",sortable:!0},{title:"Created By",sortable:!0}],this.hallOccupied=!0,this.bookingFrom="",this.bookingTo="",this.hallId=0,this.clientId=0,this.reservationForm=this.fb.group({client_id:[null,l.kI.required],hall_id:[null,l.kI.required],price:[0,l.kI.required],comment:[""]})}ngOnInit(){this.paginationService.rows$.subscribe(t=>{this.rows=t})}ngAfterViewInit(){const t=this.startDate.nativeElement,n=this.endDate.nativeElement,i=new Date,o=i.toISOString().split("T")[0],s=i.toISOString().split("T")[1].split(".")[0];(0,u.Z)(t,{enableTime:!0,allowInput:!0,dateFormat:"Y-m-d H:i",minDate:o,minTime:s,time_24hr:!0,onChange:(c,p,P)=>{this.bookingFrom=p}}),(0,u.Z)(n,{enableTime:!0,dateFormat:"Y-m-d H:i",allowInput:!0,minDate:o,minTime:s,time_24hr:!0,onChange:(c,p,P)=>{this.bookingTo=p}})}get checkAvailabilityForbidden(){return!this.bookingFrom||!this.bookingTo||!this.hallId}handleReset(){this.paymentWrapper.paymentForm.reset(),this.reservationForm.reset(),this.hallOccupied=!0,this.bookingFrom="",this.bookingTo="",this.hallId=0,this.clientId=0}handleSubmit(){const t=this.paymentWrapper.getPaymentData(),{price:n,comment:i}=this.reservationForm.value;this.hallService.handleReserve(Z._.generateFormData({client_id:this.clientId,halls:[{id:this.hallId,price:n,comment:""}],start_date:this.bookingFrom,end_date:this.bookingTo,total:n,comment:i,...t})).subscribe(c=>{this.toastService.setMessage({type:"success",text:"Reservation made successfully"}),this.rows=[...this.rows,...c],this.reservationModal.hide(),this.handleReset()})}formatReservationTime(t){const n=new Date(t);return new Intl.DateTimeFormat("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).format(n)}checkAvailability(){this.hallOccupied=!0,this.hallService.checkAvailability({hallId:this.hallId,start_date:this.bookingFrom,end_date:this.bookingFrom}).subscribe(n=>{n.success?(this.hallOccupied=!1,this.toastService.setMessage({type:"success",text:"Hall Available at selected time"})):this.toastService.setMessage({type:"danger",text:"Hall is Occupied during selected time"})})}togglePaymentWrapper(){const t=document.querySelector(".payment-wrapper");t&&t.classList.toggle("payment-hidden")}static#e=this.\u0275fac=function(n){return new(n||r)(e.Y36(A.N),e.Y36(y.m),e.Y36(C.k),e.Y36(D.F),e.Y36(l.qu))};static#t=this.\u0275cmp=e.Xpm({type:r,selectors:[["hall-reservations"]],viewQuery:function(n,i){if(1&n&&(e.Gf(U,5),e.Gf(O,5),e.Gf(E,5),e.Gf(I,5)),2&n){let o;e.iGM(o=e.CRH())&&(i.reservationModal=o.first),e.iGM(o=e.CRH())&&(i.startDate=o.first),e.iGM(o=e.CRH())&&(i.endDate=o.first),e.iGM(o=e.CRH())&&(i.paymentWrapper=o.first)}},standalone:!0,features:[e.jDz],decls:71,vars:14,consts:[[1,"row"],[1,"col-12"],[1,"page-title-box","d-sm-flex","align-items-center","justify-content-between"],[1,"mb-sm-0"],[1,"page-title-right"],[1,"breadcrumb","m-0"],[1,"breadcrumb-item"],["href","javascript: void(0);"],[1,"breadcrumb-item","active"],["url","halls/reserved",3,"columns"],["href","javascript:void(0)","prevent","","action","",1,"btn","btn-primary",3,"click"],[1,"ri-add-line","me-1","fs-16","align-middle"],["filters","",1,"d-flex","py-3","align-items-center","gap-3"],["rows","",4,"ngFor","ngForOf"],[3,"customId"],["reservationModal",""],["title",""],["body",""],[1,"auth-input",3,"formGroup","ngSubmit"],[1,"row","gy-1","gx-1"],[1,"col-lg-12"],["for","hall",1,"form-label","required",2,"z-index","10"],["url","halls/search","label","name","placeholder","Select Hall","fetchFlag","SEARCHING_HALL",3,"loadDefaults","selection","selectionChange"],[1,"col-6"],[1,"mb-0"],["for","title",1,"form-label","required"],["type","datetime-local","id","datetimePicker","placeholder","Select Datetime",1,"form-control"],["startDate",""],["type","datetime-local","id","datetimePickerTwo","placeholder","Select Datetime",1,"form-control"],["endDate",""],["class","col-lg-12",4,"ngIf","ngIfElse"],["notOccupied",""],["footer","",1,"row"],[1,"border-top","border-3","border-primary","shadow","position-absolute","w-100","p-3","bottom-0","bg-white","payment-wrapper","payment-hidden",2,"z-index","99999","margin-left","-7px"],[1,"d-flex","align-items-center","pb-2"],[1,"ms-auto"],["href","javascript:void(0)",1,"text-primary","ms-1","fw-bolder",3,"click"],[1,"ri-close-line","fw-bold","icon","fs-5"],[3,"total","paidAmount","horizontal",4,"ngIf"],[1,"row","mt-3","text-start"],["task","BOOKING_HALL","classes","btn btn-primary w-100","type","button",1,"100%",3,"disabled","clicked"],["caption",""],[1,"col-4"],["type","button",1,"btn","btn-light","w-100",3,"click"],[1,"col-8"],["type","button",1,"btn","btn-primary","w-100",3,"disabled","click"],[1,"d-flex","align-items-center"],[1,"ri-arrow-right-line",2,"vertical-align","middle"],["rows",""],[1,""],["type","button","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","btn-soft-primary","btn-sm","dropdown"],[1,"ri-more-fill","align-middle","fs-18"],[1,"dropdown-menu","dropdown-menu-end"],["href","javascript:void(0);","prevent","",1,"dropdown-item"],[1,"ri-pencil-fill","fs-18","align-middle","me-2","text-muted"],["href","javascript:void(0)","prevent","",1,"dropdown-item","remove-item-btn"],[1,"ri-delete-bin-line","fs-18","align-middle","me-2","text-muted"],["task","CHECKINING_AVAILABILITY","classes","btn btn-primary w-100","type","button",1,"w-100",3,"disabled","clicked"],["for","locaion",1,"form-label","required",2,"z-index","11"],["url","clients/search?with_phones=1","label","name","placeholder","Select Customer","fetchFlag","SEARCHING_CLIENTS",3,"loadDefaults","selection","selectionChange"],["footer","",1,"position-sticky","bottom-0","bg-white"],[1,"border-top","dropdown-item","pl-7"],["href","javascript:void(0)"],[1,"text-blue","cursor-pointer"],["height","18px","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["cx","12","cy","12","r","10"],["x1","12","y1","8","x2","12","y2","16"],["x1","8","y1","12","x2","16","y2","12"],["for","price",1,"form-label","required"],["type","number","id","price","placeholder","Price","formControlName","price",1,"form-control"],["for","description",1,"form-label"],["id","description","formControlName","comment","placeholder","Optional Comments",1,"form-control"],[3,"total","paidAmount","horizontal"],["paymentWrapper",""]],template:function(n,i){if(1&n){const o=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),e._uU(4,"Halls Reservations"),e.qZA(),e.TgZ(5,"div",4)(6,"ol",5)(7,"li",6)(8,"a",7),e._uU(9,"Reservations"),e.qZA()(),e.TgZ(10,"li",8),e._uU(11,"List"),e.qZA()()()()()(),e.TgZ(12,"app-pagination",9)(13,"a",10),e.NdJ("click",function(){e.CHM(o);const c=e.MAs(19);return e.KtG(c.show())}),e._UZ(14,"i",11),e._uU(15," New Reservation "),e.qZA(),e._UZ(16,"div",12),e.YNc(17,w,33,12,"tr",13),e.qZA(),e.TgZ(18,"app-off-canvas",14,15)(20,"span",16),e._uU(21,"Add a Hall Reservation"),e.qZA(),e.TgZ(22,"div",17)(23,"form",18),e.NdJ("ngSubmit",function(){return i.handleSubmit()}),e.TgZ(24,"div",19)(25,"div",20)(26,"label",21),e._uU(27,"Hall"),e.qZA(),e.TgZ(28,"app-custom-select",22),e.NdJ("selectionChange",function(c){return i.hallId=c}),e.qZA()(),e.TgZ(29,"div",23)(30,"div",24)(31,"label",25),e._uU(32,"Check-in"),e.qZA(),e._UZ(33,"input",26,27),e.qZA()(),e.TgZ(35,"div",23)(36,"div",24)(37,"label",25),e._uU(38,"Check-out"),e.qZA(),e._UZ(39,"input",28,29),e.qZA()(),e.YNc(41,M,4,1,"div",30)(42,R,24,2,"ng-template",null,31,e.W1O),e.qZA()()(),e.TgZ(44,"div",32)(45,"div",33)(46,"div",34)(47,"h5",24),e._uU(48,"Process Payment"),e.qZA(),e.TgZ(49,"div",35)(50,"a",36),e.NdJ("click",function(){return i.togglePaymentWrapper()}),e._UZ(51,"i",37),e.qZA()()(),e.YNc(52,k,2,3,"payment-wrapper",38),e.TgZ(53,"div",39)(54,"div",1)(55,"app-button",40),e.NdJ("clicked",function(){return i.handleSubmit()}),e.TgZ(56,"span",41),e._uU(57,"Confirm and Save"),e.qZA()()()()(),e.TgZ(58,"div",42)(59,"button",43),e.NdJ("click",function(){return i.handleReset()}),e._uU(60," Reset "),e.qZA()(),e.TgZ(61,"div",44)(62,"button",45),e.NdJ("click",function(){return i.togglePaymentWrapper()}),e.TgZ(63,"span",41)(64,"div",46)(65,"span"),e._uU(66),e.ALo(67,"formatMoney"),e.qZA(),e.TgZ(68,"div",35),e._uU(69," Proceed Payment "),e._UZ(70,"em",47),e.qZA()()()()()()()}if(2&n){const o=e.MAs(43);e.xp6(12),e.Q6J("columns",i.columns),e.xp6(5),e.Q6J("ngForOf",i.rows),e.xp6(1),e.Q6J("customId","reservationModal"),e.xp6(5),e.Q6J("formGroup",i.reservationForm),e.xp6(5),e.Q6J("loadDefaults",!0)("selection",i.hallId),e.xp6(13),e.Q6J("ngIf",i.hallOccupied)("ngIfElse",o),e.xp6(11),e.Q6J("ngIf",i.reservationForm.value.price),e.xp6(3),e.Q6J("disabled",!1),e.xp6(7),e.Q6J("disabled",!i.clientId||!i.reservationForm.value.price),e.xp6(4),e.Oqu(e.lcZ(67,12,i.reservationForm.value.price))}},dependencies:[v.Q,_.ax,_.O5,h.r,g.i,l.UX,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.sg,l.u,f.y,b.T,T.l],styles:[".payment-hidden[_ngcontent-%COMP%]{visibility:hidden;padding:0!important;transform:translateY(100%)}.payment-wrapper[_ngcontent-%COMP%]{transition:visibility .5s,padding .5s ease,transform .5s ease;transition-timing-function:cubic-bezier(.005,1.045,.25,.915)!important}"]})}return r})()}}]);